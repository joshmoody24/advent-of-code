INCLUDE "hardware.inc"

SECTION "Header", ROM0[$100]

  jp EntryPoint

  ds $150 - @, 0 ; Make room for the header

EntryPoint:
  ; Do not turn the LCD off outside of VBlank
WaitVBlank:
  ld a, [rLY]
  cp 144
  jp c, WaitVBlank
  
  ; Turn the LCD off
  ld a, 0
  ld [rLCDC], a
  
  ; Copy the tile data
  ld de, Tiles
  ld hl, $9000
  ld bc, TilesEnd - Tiles
CopyTiles:
  ld a, [de]
  ld [hli], a
  inc de
  dec bc
  ld a, b
  or a, c
  jp nz, CopyTiles
  
  ; Copy the tilemap
  ld de, Tilemap
  ld hl, $9800
  ld bc, TilemapEnd - Tilemap
CopyTilemap:
  ld a, [de]
  ld [hli], a
  inc de
  dec bc
  ld a, b
  or a, c
  jp nz, CopyTilemap
  
  ; Turn the LCD on
  ld a, LCDCF_ON | LCDCF_BGON
  ld [rLCDC], a
  
  ; During the first (blank) frame, initialize display registers
  ld a, %11100100
  ld [rBGP], a
  
  ld hl, Input
  call ParseFirstNumber ; TODO: more than just the first number

Done:
    jp Done
    

ParseFirstNumber:
    ; DE = 0
    xor a
    ld d, a
    ld e, a

.parse_loop:
    ld a, [hl] ; a = current char

    cp '-' ; stop at '-'
    jr z, .done

    sub '0' ; a = digit 0..9
    ld b, a ; save digit in b

    ; de *= 10
    call MulDeBy10
    
    ; DE = DE + digit (in b)
    ld a, e
    add b ; low byte += digit
    ld e, a
    ld a, d
    adc 0 ; high byte += carry
    ld d, a

    inc hl ; move to next input character
    jr .parse_loop

.done:
    ret

; de *= 10
MulDeBy10:
    push af
    push bc
    push hl
    
    ; Copy de into bc (original value)
    ld b, d
    ld c, e

    ; hl = 0 (accumulator)
    xor a
    ld h, a
    ld l, a

    ; a = 10 (loop counter)
    ld a, 10

.mul_loop:
    add hl, bc ; hl += original
    dec a
    jr nz, .mul_loop

    ; hl now has de * 10
    ld d, h
    ld e, l
    
    pop hl
    pop bc
    pop af
    ret
    
Tiles:
  ; Background
	dw `33333333
	dw `33333333
	dw `33333333
	dw `33300000
	dw `33300000
	dw `33300000
	dw `33300011
	dw `33300011

	dw `33333333
	dw `33333333
	dw `33333333
	dw `00000000
	dw `00000000
	dw `00000000
	dw `11111111
	dw `11111111

	dw `33333333
	dw `33333333
	dw `33333333
	dw `00000333
	dw `00000333
	dw `00000333
	dw `11000333
	dw `11000333

	dw `33300011
	dw `33300011
	dw `33300011
	dw `33300011
	dw `33300011
	dw `33300011
	dw `33300011
	dw `33300011

	dw `11000333
	dw `11000333
	dw `11000333
	dw `11000333
	dw `11000333
	dw `11000333
	dw `11000333
	dw `11000333

	dw `22222222
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22222222

	dw `11221122
	dw `11111111
	dw `11111111
	dw `01010101
	dw `00000000
	dw `00300030
	dw `03030303
	dw `33333333
	
	; Letters
	; I
	dw `20000022
	dw `23303322
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `20000022
	dw `23333322
	
	; n
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22000222
	dw `22033022
	dw `22022022
	dw `22022022
	dw `22322322
	
	; v
	dw `22222222
	dw `22222222
	dw `22222222
	dw `20222022
	dw `20222022
	dw `23020322
	dw `22303222
	dw `22232222
	
	; a
	dw `22222222
	dw `22222222
	dw `22200222
	dw `22233022
	dw `22200022
	dw `22033022
	dw `22300322
	dw `22233222
	
	; l
	dw `22222222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22232222
	
	; i
	dw `22222222
	dw `22222222
	dw `22202222
	dw `22232222
	dw `22202222
	dw `22202222
	dw `22202222
	dw `22232222
	
	; d
	dw `22222222
	dw `22222022
	dw `22222022
	dw `22200022
	dw `22033022
	dw `22022022
	dw `22300322
	dw `22233222
	
	; s
	dw `22222222
	dw `22222222
	dw `22200022
	dw `22033322
	dw `22300222
	dw `22233022
	dw `22000322
	dw `22333222
	
	; u
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22022022
	dw `22022022
	dw `22022022
	dw `22300322
	dw `22233222
	
	; m
	dw `22222222
	dw `22222222
	dw `22222222
	dw `22020222
	dw `20303022
	dw `20202022
	dw `20202022
	dw `23232322
	
	; D
	dw `22000222
	dw `22033022
	dw `22022022
	dw `22022022
	dw `22022022
	dw `22022022
	dw `22000222
	dw `22333222
	
	; =
	dw `22222222
	dw `22222222
	dw `22200022
	dw `22233322
	dw `22222222
	dw `22200022
	dw `22233322
	dw `22222222

  ; digits
  ; 0
  dw `22222222
  dw `22000022
  dw `20022002
  dw `20022002
  dw `20022002
  dw `20022002
  dw `22000022
  dw `22222222
  ; 1
  dw `22222222
  dw `22200222
  dw `22000222
  dw `22200222
  dw `22200222
  dw `22200222
  dw `22000022
  dw `22222222
  ; 2
  dw `22222222
  dw `22000022
  dw `20220002
  dw `22220002
  dw `22000222
  dw `20002222
  dw `20000002
  dw `22222222
  ; 2
  dw `22222222
  dw `20000022
  dw `22220002
  dw `22000022
  dw `22220002
  dw `22220002
  dw `20000022
  dw `22222222
  ; 4
  dw `22222222
  dw `22000022
  dw `20020022
  dw `20220022
  dw `20220022
  dw `20000002
  dw `22220022
  dw `22222222
  ; 5
  dw `22222222
  dw `20000022
  dw `20022222
  dw `20000022
  dw `22220002
  dw `20220002
  dw `22000022
  dw `22222222
  ; 6
  dw `22222222
  dw `22000022
  dw `20022222
  dw `20000022
  dw `20022002
  dw `20022002
  dw `22000022
  dw `22222222
  ; 7
  dw `22222222
  dw `20000002
  dw `22222002
  dw `22220022
  dw `22200222
  dw `22000222
  dw `22000222
  dw `22222222
  ; 8
  dw `22222222
  dw `22000022
  dw `20222002
  dw `22000022
  dw `20222002
  dw `20222002
  dw `22000022
  dw `22222222
  ; 9
  dw `22222222
  dw `22000022
  dw `20220002
  dw `20220002
  dw `22000002
  dw `22220002
  dw `22000022
  dw `22222222
  
TilesEnd:
Tilemap:
	db $00, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $01, $02, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $07, $08, $09, $0a, $0b, $0c, $0d, $05, $07, $11, $05, $0e, $0f, $10, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $12, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $05, $04, 0,0,0,0,0,0,0,0,0,0,0,0
	db $03, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $06, $04, 0,0,0,0,0,0,0,0,0,0,0,0
TilemapEnd:

Input:
db "11-22,95-115,998-1012,1188511880-1188511890,222220-222224,1698522-1698528,446443-446449,38593856-38593862,565653-565659,824824821-824824827,2121212118-2121212124"
InputEnd:
